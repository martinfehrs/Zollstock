set(quantities_dir ${CMAKE_CURRENT_SOURCE_DIR}/quantity_tests)
set(units_dir ${CMAKE_CURRENT_SOURCE_DIR}/unit_tests)
set(unit_constants_dir ${units_dir}/constants)
set(unit_literals_dir ${units_dir}/literals)

target_sources(tests PRIVATE ${units_dir}/prefixes.cpp)
target_sources(tests PRIVATE ${unit_literals_dir}/area.cpp)
target_sources(tests PRIVATE ${unit_literals_dir}/volume.cpp)
target_sources(tests PRIVATE ${unit_literals_dir}/planar_angle.cpp)
target_sources(tests PRIVATE ${unit_literals_dir}/one.cpp)
target_sources(tests PRIVATE ${unit_constants_dir}/area.cpp)
target_sources(tests PRIVATE ${unit_constants_dir}/volume.cpp)
target_sources(tests PRIVATE ${unit_constants_dir}/planar_angle.cpp)
target_sources(tests PRIVATE ${unit_constants_dir}/one.cpp)
target_sources(tests PRIVATE ${unit_constants_dir}/squared_time.cpp)
target_sources(tests PRIVATE ${unit_constants_dir}/velocity.cpp)
target_sources(tests PRIVATE ${unit_constants_dir}/acceleration.cpp)
target_sources(tests PRIVATE ${unit_constants_dir}/angular_velocity.cpp)
target_sources(tests PRIVATE ${quantities_dir}/construction.cpp)
target_sources(tests PRIVATE ${quantities_dir}/quantity.cpp)
target_sources(tests PRIVATE ${quantities_dir}/math.cpp)
target_sources(tests PRIVATE ${quantities_dir}/limits.cpp)
target_sources(tests PRIVATE structure_tests.cpp)

file(GLOB_RECURSE headers RELATIVE "${CMAKE_SOURCE_DIR}/include" "${CMAKE_SOURCE_DIR}/include/zollstock/*.hpp")

set(base_dimension_names length mass time electric_current temperature amount_of_substance luminous_intensity)
set(base_dimension_symbols L M T I Theta N J)
set(si_base_unit_symbols m g s A K mol cd)

foreach(entry IN ZIP_LISTS base_dimension_names base_dimension_symbols si_base_unit_symbols)
    string(REPLACE "_" "-" hyphenated_base_dimension_name ${entry_0})
    set(base_constant_tests_templ "${unit_constants_dir}/base_constant_tests.cpp.in")
    set(base_literal_tests_templ  "${unit_literals_dir}/base_literal_tests.cpp.in")
    set(base_constant_tests_src "${CMAKE_CURRENT_BINARY_DIR}/base_constants/${entry_0}.cpp")
    set(base_literal_tests_src  "${CMAKE_CURRENT_BINARY_DIR}/base_literals/${entry_0}.cpp")
    configure_file("${base_constant_tests_templ}" "${base_constant_tests_src}")
    configure_file("${base_literal_tests_templ}"  "${base_literal_tests_src}")
    target_sources(tests PRIVATE "${base_constant_tests_src}")
    target_sources(tests PRIVATE "${base_literal_tests_src}")
endforeach()

foreach(header ${headers})
    cmake_path(GET header PARENT_PATH parent_path)
    cmake_path(GET header STEM stem)
    set(self_containment_test_dir "${CMAKE_CURRENT_BINARY_DIR}/self_containment/${parent_path}")
    set(self_containment_test_src "${self_containment_test_dir}/${stem}_self_containment_test.cpp")
    file(MAKE_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}/self_containment/${parent_path}")
    set(TEST_INCLUDE_PATH "${header}")
    configure_file("header_self_containment_test.cpp.in" "${self_containment_test_src}")
    target_sources(tests PRIVATE "${self_containment_test_src}")
endforeach()

if (MSVC)
    target_link_options   (tests PRIVATE "/stack:10000000")
    target_compile_options(tests PRIVATE "/bigobj"        )
endif(MSVC)
